import streamlit as st
import pandas as pd
from datetime import datetime, date
from pyluach import dates

# ×”×’×“×¨×•×ª ×¢×™×¦×•×‘
st.set_page_config(page_title="Birthday Cloud Hub", layout="wide")

st.markdown("""
    <style>
    .main { direction: rtl; text-align: right; }
    h1 { color: #FF4B4B; text-align: center; }
    .birthday-card {
        background: linear-gradient(135deg, #fff5f5 0%, #feb2b2 100%);
        padding: 30px; border-radius: 20px; text-align: center;
        border: 2px dashed #FF4B4B; margin-bottom: 20px;
    }
    .section-header { background: #FF4B4B; color: white; padding: 10px; border-radius: 10px; font-weight: bold; }
    </style>
    """, unsafe_allow_html=True)

# ×¤×•× ×§×¦×™×•×ª ×—×™×©×•×‘
def get_zodiac(dt):
    day, month = dt.day, dt.month
    if (month == 3 and day >= 21) or (month == 4 and day <= 19): return "×˜×œ×” â™ˆ"
    if (month == 4 and day >= 20) or (month == 5 and day <= 20): return "×©×•×¨ â™‰"
    if (month == 5 and day >= 21) or (month == 6 and day <= 20): return "×ª××•××™× â™Š"
    if (month == 6 and day >= 21) or (month == 7 and day <= 22): return "×¡×¨×˜×Ÿ â™‹"
    if (month == 7 and day >= 23) or (month == 8 and day <= 22): return "××¨×™×” â™Œ"
    if (month == 8 and day >= 23) or (month == 9 and day <= 22): return "×‘×ª×•×œ×” â™"
    if (month == 9 and day >= 23) or (month == 10 and day <= 22): return "×××–× ×™×™× â™"
    if (month == 10 and day >= 23) or (month == 11 and day <= 21): return "×¢×§×¨×‘ â™"
    if (month == 11 and day >= 22) or (month == 12 and day <= 21): return "×§×©×ª â™"
    if (month == 12 and day >= 22) or (month == 1 and day <= 19): return "×’×“×™ â™‘"
    if (month == 1 and day >= 20) or (month == 2 and day <= 18): return "×“×œ×™ â™’"
    return "×“×’×™× â™“"

def calculate_age(birth_date):
    today = date.today()
    return today.year - birth_date.year - ((today.month, today.day) < (birth_date.month, birth_date.day))

st.markdown("<h1>ğŸŠ ×™××™ ×”×•×œ×“×ª ××¡×•× ×›×¨× ×™× ×œ×¢× ×Ÿ ğŸŠ</h1>", unsafe_allow_html=True)

# ×”×–× ×ª ×”×§×™×©×•×¨ ××”×’×•×’×œ ×©×™×˜×¡ (×”-CSV ×©×¤×¨×¡××ª)
csv_url = st.text_input("×”×“×‘×§ ×›××Ÿ ××ª ×§×™×©×•×¨ ×”-CSV ×©×§×™×‘×œ×ª ×'×¤×¨×¡×•× ×‘××™× ×˜×¨× ×˜':")

if csv_url:
    try:
        # ×§×¨×™××ª ×”× ×ª×•× ×™×
        df = pd.read_csv(csv_url)
        # × ×™×§×•×™ ×¢××•×“×•×ª ×œ××§×¨×” ×©×™×© ×¨×•×•×—×™×
        df.columns = df.columns.str.strip()
        df['Birthday'] = pd.to_datetime(df['Birthday']).dt.date
        
        today = date.today()
        
        # ×—×™×©×•×‘×™×
        df['×ª××¨×™×š ×¢×‘×¨×™'] = df['Birthday'].apply(lambda x: dates.HebrewDate.from_pydate(x).hebrew_date_string())
        df['×’×™×œ'] = df['Birthday'].apply(calculate_age)
        df['××–×œ'] = df['Birthday'].apply(get_zodiac)
        
        # ×–×™×”×•×™ ×—×•×’×’×™× ×”×™×•×
        celebrating = df[(df['Birthday'].apply(lambda x: x.month == today.month and x.day == today.day))]
        
        if not celebrating.empty:
            st.balloons()
            for _, row in celebrating.iterrows():
                st.markdown(f"""
                    <div class="birthday-card">
                        <h2>ğŸ‚ ××–×œ ×˜×•×‘ ×œ-{row['Full_Name']}!</h2>
                        <p>×—×•×’×’/×ª ×”×™×•× {int(row['×’×™×œ'])} ×©× ×™× (××–×œ {row['××–×œ']})</p>
                    </div>
                """, unsafe_allow_html=True)

        # ×˜×‘×œ×” ××œ××”
        st.markdown('<div class="section-header">ğŸ“‹ ×¨×©×™××ª ×™××™ ×”×•×œ×“×ª ××¢×•×“×›× ×ª</div>', unsafe_allow_html=True)
        st.dataframe(df[['Full_Name', 'Birthday', '×ª××¨×™×š ×¢×‘×¨×™', '××–×œ', '×’×™×œ']], use_container_width=True, hide_index=True)

    except Exception as e:
        st.warning("×××ª×™×Ÿ ×œ×§×™×©×•×¨ CSV ×ª×§×™×Ÿ ××’×•×’×œ ×©×™×˜×¡...")
else:
    st.info("×›×“×™ ×œ×”×ª×—×™×œ, ×¤×¨×¡× ××ª ×”×’×•×’×œ ×©×™×˜×¡ ×©×œ×š ×›-CSV ×•×”×“×‘×§ ××ª ×”×§×™×©×•×¨ ×œ××¢×œ×”.")